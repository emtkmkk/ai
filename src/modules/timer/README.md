# timer

メンションで時間を指定すると、指定時間後にリプライで通知するタイマー機能。

## 動作フロー

```mermaid
flowchart TD
    A["ユーザーが\n「3分30秒」などを\nメンションで送信"] --> B["正規表現で\n秒/分/時間/日を抽出"]
    B --> C{"時間指定\nキーワードあり?"}
    C -- いいえ --> Z["スキップ"]
    C -- はい --> D{"合計時間 = 0?"}
    D -- はい --> E["「時間の指定が\n正しくない」と返信"]
    D -- いいえ --> F{"30日超?"}
    F -- はい --> G["「長すぎる」と返信"]
    F -- いいえ --> H["タイマーをセット\n+ 確認メッセージ返信"]
    H --> I["⏳ 指定時間経過"]
    I --> J["元の投稿に返信で通知"]
    J --> K{"返信成功?"}
    K -- はい --> L["完了"]
    K -- いいえ --> M["ホームに直接投稿\n(元投稿が削除済みなど)"]
```

## 仕様

| 項目 | 内容 |
|---|---|
| トリガー | メンションに `〇秒`, `〇分`, `〇時間`, `〇日` が含まれる |
| 最大時間 | 30日（2,592,000,000ミリ秒） |
| 通知方法 | 元の投稿への返信（失敗時はホームに投稿） |
| 通知の公開範囲 | `home` |
| 永続化 | あり（プロセス再起動後もタイマーが有効） |
| 使用フック | `mentionHook`, `timeoutCallback` |

### 入力例

| 入力 | タイマー時間 |
|---|---|
| `3分` | 3分 |
| `1時間30分` | 1時間30分 |
| `2日5時間` | 2日5時間 |
| `90秒` | 90秒 |
| `31日` | 拒否（30日超） |
| `0分` | 無効 |

### 永続化について

タイマーは `setTimeoutWithPersistence` を使用してDBに保存される。  
ボットが途中で再起動しても、残り時間が経過すれば通知が届く。
