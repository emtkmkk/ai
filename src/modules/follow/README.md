# follow

フォローバック管理と、条件を満たさないリモートフォローの自動解除を行うモジュール。

## 機能概要

1. **フォローバック**: メンションで「フォロー」と言われたらフォローバックを実行
2. **自動フォロー解除**: ホームTLを監視し、条件を満たさないリモートユーザーのフォローを段階的に解除

---

## 1. フォローバック

```mermaid
flowchart TD
    A["ユーザーがメンションで<br/>「フォロー」「フォロバ」と送信"] --> B{"リノートミュート中?"}
    B -- はい --> Z1["拒否"]
    B -- いいえ --> C{"リモートユーザー?"}
    C -- いいえ --> F{"既にフォロー済み?"}
    C -- はい --> D{"親愛度 ≥ 10?"}
    D -- いいえ --> Z2["「もう少し関わりを<br/>持ってから…」と返信"]
    D -- はい --> E{"相手が<br/>フォロバしてる?"}
    E -- いいえ --> Z3["「相手がフォロバ<br/>していません」と返信"]
    E -- はい --> F
    F -- はい --> Z4["「もうフォローしています」<br/>と返信"]
    F -- いいえ --> G["フォローバック実行<br/>+ 完了メッセージ"]
```

### フォローバック条件まとめ

| 条件 | ローカルユーザー | リモートユーザー |
| --- | --- | --- |
| 親愛度制限 | なし | 10以上必要 |
| 相手のフォロバ | 不問 | 必要 |
| リノートミュート中 | 拒否 | 拒否 |

---

## 2. 自動フォロー解除

ホームTLのノートを監視し、リモートユーザーのフォロー状態を定期的にチェックする。

```mermaid
flowchart TD
    A["ホームTLでノート受信"] --> B{"Bot以外の<br/>リモートユーザー?"}
    B -- いいえ --> Z["無視"]
    B -- はい --> C{"相手が<br/>フォロバしてる?"}
    C -- いいえ --> D["即フォロー解除"]
    C -- はい --> E{"親愛度 ≥ 10?"}
    E -- いいえ --> D
    E -- はい --> F{"親愛度 ≥ 100?"}
    F -- はい --> Z2["維持"]
    F -- いいえ --> G{"最後の親愛度増加から<br/>一定期間経過?"}
    G -- いいえ --> Z2
    G -- はい --> H["removeCount +1"]
    H --> I{"removeCount ≥ 20?"}
    I -- いいえ --> Z3["保留"]
    I -- はい --> D
```

### フォロー解除条件

| 条件 | アクション |
| --- | --- |
| 相手がフォロバしていない | 即解除 |
| 親愛度10未満 | 即解除 |
| 親愛度10〜99 + 一定期間アクティビティなし | `removeCount` を蓄積。20回で解除 |
| 親愛度100以上 | 解除しない |

### 猶予期間の計算

アクティビティがないと判定される期間（猶予期間）:

| 親愛度 | 猶予期間 |
| --- | --- |
| 10〜49 | `親愛度 × 0.3日` |
| 50〜99 | `親愛度 × 0.3日 × 2`（2倍の猶予） |

例: 親愛度30 → 9日間アクティビティがないと removeCount が蓄積開始
