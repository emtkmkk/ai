# welcome

新規ユーザーの初投稿を祝い、キリ番投稿を通知するモジュール。

## 機能概要

1. **初投稿祝い**: 初めて投稿したユーザーをリノート＋リアクション＋メッセージで歓迎
2. **キリ番通知**: 特定のノート数に達したユーザーに通知

---

## 1. 初投稿祝い

```mermaid
sequenceDiagram
    participant U as 新規ユーザー
    participant B as ボット
    Note over U: 初投稿
    U->>B: ローカルTLに流れる
    B->>B: 3秒待機
    B->>U: リノート
    B->>B: 1.5秒待機
    B->>U: :mk_hi: リアクション
    B->>B: 1秒待機
    B->>U: :youkoso: リアクション
    B->>B: 1秒待機
    B->>U: :supertada: リアクション
    B->>B: 1.5秒待機
    B->>U: ウェルカムメッセージ (DM)
```

### 初投稿の判定条件

- `isFirstNote` フラグが `true`
- **または** ノート数が50以下（初投稿フラグがない場合のフォールバック）
- 一度送信したユーザーには再送しない（`isWelcomeMessageSent` フラグで管理）

---

## 2. キリ番通知

```mermaid
flowchart TD
    A["ローカルTLでノート受信"] --> B{"Bot以外の\nローカルユーザー?"}
    B -- いいえ --> Z["無視"]
    B -- はい --> C{"親愛度 ≥ 20?"}
    C -- いいえ --> Z
    C -- はい --> D{"公開 or home 投稿?\nかつ CW なし?"}
    D -- いいえ --> Z
    D -- はい --> E{"ノート数が\nキリ番ターゲット?"}
    E -- いいえ --> Z
    E -- はい --> F["DMでお祝い"]
```

### キリ番ターゲット

| ノート数 | 説明 |
|---|---|
| 50 | |
| 100 | |
| 500 | |
| 1,000 | |
| 5,000 | |
| 10,000, 15,000, ... | 5,000刻みで継続 |

## 仕様

| 項目 | 内容 |
|---|---|
| トリガー | ローカルTLのノートイベント |
| 初投稿祝い対象 | Bot以外のローカルユーザー |
| キリ番対象 | 親愛度20以上 + 公開/home投稿 + CWなし |
| 使用フック | なし（ストリームイベント直接購読） |
